<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Myanmar PCode Search</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --background-color: #f5f5f5;
            --card-background: #ffffff;
            --text-color: #333;
            --border-radius: 8px;
            --box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
        }

        .search-section {
            flex: 1;
            min-width: 300px;
        }

        .map-section {
            flex: 1;
            min-width: 300px;
        }

        #map {
            height: 600px;
            width: 100%;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .header {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
        }

        h1 {
            color: var(--primary-color);
            font-size: 24px;
            margin-bottom: 10px;
        }

        .search-type-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .toggle-btn {
            padding: 8px 16px;
            border: none;
            background-color: var(--background-color);
            color: var(--text-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-btn.active {
            background-color: var(--accent-color);
            color: white;
        }

        .toggle-btn i {
            margin-right: 8px;
        }

        .filters {
            background: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: var(--secondary-color);
            font-weight: 500;
        }

        select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
        }

        .search-container {
            background: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 40px 12px 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .search-icon {
            position: absolute;
            right: 32px;
            top: 32px;
            color: #999;
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .suggestion-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s ease;
        }

        .suggestion-item:hover {
            background-color: #f8f9fa;
        }

        .suggestion-item .town-name {
            font-weight: 500;
            color: var(--primary-color);
        }

        .suggestion-item .hierarchy {
            font-size: 0.9em;
            color: #666;
            margin-top: 4px;
        }

        .result {
            background: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-top: 20px;
            display: none;
        }

        .result h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 20px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 4px;
        }

        .language-toggle {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 8px;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            #map {
                height: 400px;
            }

            .search-section, .map-section {
                width: 100%;
            }

        .result-grid {
            grid-template-columns: 1fr;
        }
    }

    .footer {
        background: var(--card-background);
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        margin-top: 20px;
        font-size: 0.9em;
        color: var(--secondary-color);
        line-height: 1.6;
    }

    .footer a {
        color: var(--accent-color);
        text-decoration: none;
    }

    .footer a:hover {
        text-decoration: underline;
    }
</style>
</head>
<body>
    <div class="container">
        <div class="search-section">
            <div class="header">
                <h1><i class="fas fa-map-marker-alt"></i> Myanmar PCode Search</h1>
                
                <div class="search-type-toggle">
                    <button class="toggle-btn active" id="townSearchBtn">
                        <i class="fas fa-city"></i> Search by Town
                    </button>
                    <button class="toggle-btn" id="pcodeSearchBtn">
                        <i class="fas fa-hashtag"></i> Search by PCode
                    </button>
                </div>
            </div>

            <div class="search-container">
                <div class="language-toggle">
                    <input type="checkbox" id="mmText" onchange="toggleLanguage()">
                    <label for="mmText"><i class="fas fa-language"></i> Show Myanmar Text</label>
                </div>
                <input type="text" 
                       class="search-input" 
                       id="searchInput"
                       placeholder="Search by town name..."
                       aria-label="Search">
                <i class="fas fa-search search-icon"></i>
                <div class="suggestions"></div>
            </div>
            
            <div class="result"></div>
        </div>
        
        <div class="map-section">
            <div id="map"></div>
            <div class="footer">
        <p><strong>Source:</strong> Myanmar PCodes Release_9.5_Feb_2024_Countrywide from the Myanmar Information Management Unit (MIMU)</p>
        <p><strong>Version:</strong> PCode version 9.5 (February 2024)</p>
        <p><strong>Data Source:</strong> <a href="https://themimu.info/place-codes" target="_blank">MIMU Place Codes</a></p>
        <p><strong>Developed by:</strong> Dr. Nyein Chan Ko Ko + Claude</p>
            </div>
        </div>
    </div>

    <script src="map.js"></script>
    <script>
        let pcodeData = [];
        let filteredData = [];
        const searchInput = document.querySelector('.search-input');
        const suggestionsContainer = document.querySelector('.suggestions');
        const resultContainer = document.querySelector('.result');
        let showMyanmarText = false;
        let searchByPcode = false;

        // Search type toggle
        const townSearchBtn = document.getElementById('townSearchBtn');
        const pcodeSearchBtn = document.getElementById('pcodeSearchBtn');

        townSearchBtn.addEventListener('click', () => {
            searchByPcode = false;
            townSearchBtn.classList.add('active');
            pcodeSearchBtn.classList.remove('active');
            searchInput.placeholder = 'Search by town name...';
            searchInput.value = '';
            suggestionsContainer.style.display = 'none';
        });

        pcodeSearchBtn.addEventListener('click', () => {
            searchByPcode = true;
            pcodeSearchBtn.classList.add('active');
            townSearchBtn.classList.remove('active');
            searchInput.placeholder = 'Search by PCode...';
            searchInput.value = '';
            suggestionsContainer.style.display = 'none';
        });

        function toggleLanguage() {
            showMyanmarText = document.getElementById('mmText').checked;
            if (searchInput.value) {
                const matches = searchPcodes(searchInput.value);
                showSuggestions(matches);
            }
        }

        function updateFilters() {
            // Initialize filteredData with all data
            filteredData = pcodeData;
        }

        async function loadCSVData(file) {
            try {
                const response = await fetch(file);
                const csvText = await response.text();
                Papa.parse(csvText, {
                    header: true,
                    complete: function(results) {
                        pcodeData = results.data;
                        filteredData = pcodeData;
                        updateFilters();
                        console.log('CSV data loaded:', pcodeData.length, 'records');
                    }
                });
            } catch (error) {
                console.error('Error loading CSV:', error);
            }
        }

        function searchPcodes(query) {
            query = query.toLowerCase();
            return filteredData.filter(item => {
                if (searchByPcode) {
                    return (
                        item.Town_Pcode?.toLowerCase().includes(query) ||
                        item.Tsp_Pcode?.toLowerCase().includes(query) ||
                        item['District/SAZ_Pcode']?.toLowerCase().includes(query) ||
                        item.SR_Pcode?.toLowerCase().includes(query)
                    );
                } else {
                    return (
                        (item.Town_Name_Eng && item.Town_Name_Eng.toLowerCase().includes(query)) ||
                        (item.Town_Name_MMR && item.Town_Name_MMR.toLowerCase().includes(query))
                    );
                }
            }).slice(0, 10);
        }

        function showSuggestions(matches) {
            suggestionsContainer.innerHTML = '';
            if (matches.length > 0) {
                matches.forEach(match => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    
                    let mainText;
                    if (searchByPcode) {
                        mainText = `${match.Town_Pcode} - ${match.Town_Name_Eng}`;
                    } else {
                        mainText = showMyanmarText && match.Town_Name_MMR ? 
                            `${match.Town_Name_MMR} (${match.Town_Name_Eng})` : 
                            match.Town_Name_Eng;
                    }
                    
                    div.innerHTML = `
                        <div class="town-name">${mainText}</div>
                        <div class="hierarchy">
                            ${match.SR_Name_Eng} > ${match['District/SAZ_Name_Eng']} > ${match.Township_Name_Eng}
                        </div>
                    `;
                    
                    div.addEventListener('click', () => {
                        searchInput.value = mainText;
                        suggestionsContainer.style.display = 'none';
                        showResult(match);
                        if (match.Latitude && match.Longitude) {
                            zoomToLocation(match.Latitude, match.Longitude);
                            addSingleMarker(match);
                        }
                    });
                    suggestionsContainer.appendChild(div);
                });
                suggestionsContainer.style.display = 'block';
            } else {
                suggestionsContainer.style.display = 'none';
            }
        }

        function showResult(match) {
            resultContainer.innerHTML = `
                <h2>Location Details</h2>
                <div class="result-grid">
                    <div class="result-item">
                        <strong>State/Region:</strong><br>${match.SR_Name_Eng || 'N/A'}
                    </div>
                    <div class="result-item">
                        <strong>State/Region PCode:</strong><br>${match.SR_Pcode || 'N/A'}
                    </div>
                    <div class="result-item">
                        <strong>District/SAZ:</strong><br>${match['District/SAZ_Name_Eng'] || 'N/A'}
                    </div>
                    <div class="result-item">
                        <strong>District/SAZ PCode:</strong><br>${match['District/SAZ_Pcode'] || 'N/A'}
                    </div>
                    <div class="result-item">
                        <strong>Township:</strong><br>${match.Township_Name_Eng || 'N/A'}
                    </div>
                    <div class="result-item">
                        <strong>Township PCode:</strong><br>${match.Tsp_Pcode || 'N/A'}
                    </div>
                    <div class="result-item">
                        <strong>Town Name (English):</strong><br>${match.Town_Name_Eng || 'N/A'}
                    </div>
                    <div class="result-item">
                        <strong>Town Name (Myanmar):</strong><br>${match.Town_Name_MMR || 'N/A'}
                    </div>
                    <div class="result-item">
                        <strong>Town PCode:</strong><br>${match.Town_Pcode || 'N/A'}
                    </div>
                    <div class="result-item">
                        <strong>Coordinates:</strong><br>
                        Lat: ${match.Latitude || 'N/A'}, Long: ${match.Longitude || 'N/A'}
                    </div>
                </div>
            `;
            resultContainer.style.display = 'block';
        }

        // Event Listeners
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value;
            if (query.length >= 2) {
                const matches = searchPcodes(query);
                showSuggestions(matches);
            } else {
                suggestionsContainer.style.display = 'none';
            }
        });

        document.addEventListener('click', (e) => {
            if (!suggestionsContainer.contains(e.target) && e.target !== searchInput) {
                suggestionsContainer.style.display = 'none';
            }
        });

        loadCSVData('your-pcode-data.csv');
    </script>
</body>
</html>
